
{% for row in items_on_page %}
<style>
.form-popup {
 display: none;
 position: fixed;
 bottom: 0;
 right: 15px;
 border: 3px solid #f1f1f1;
 z-index: 9;
}
.defaultskin {
 display: none;
}
</style>
<tr>
 


</tr>
{% endfor %}

<div class="modal fade" id="editStudentModal" tabindex="-1" aria-labelledby="editStudentModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
         <div class="modal-header" style="background-color:#0d6efd;">
        <h5 class="modal-title text-white"
            >
          Edit Student
        </h5>
        <button type="button" class="btn-close btn-close-white"
                data-bs-dismiss="modal"></button>
      </div>
      
      <div class="modal-body">

        
        

         <form action="/s_update" method="post" enctype="multipart/form-data" id="editStudentForm">
           <input type="hidden" name="s_id" id="edit_s_id" >
          <div class="mb-3">
            <label for="profilePictureEdit" class="form-label">Input Image (2MB max)
            <input type="file"  id="profilePictureEdit" name="profilePictureEdit" accept=".jpg,.jpeg,.png"  class="d-none">
            <div class="upload-box">
            <img src="{{ url_for('static', filename='imgs/rt.jpg') }}"
            style = "width:100px;height:100px;border-radius:50%;"
            class="upload-icon">

            <img id="preview_edit_profile" class="preview-img" style="display:none;width:100px;height:100px;border-radius:50%;">
           </div>
           </label>
          </div>
        
          <div class="mb-3">
            <input type="text" id="edit_first_name" class="form-control" name="First_Name"  required>
          </div>
          
          <div class="mb-3">
            <input type="text" id="edit_last_name" class="form-control" name="Last_Name" required>
          </div>
          
          <div class="mb-3">
            <label class="form-label">Program</label>
            <select class="form-select" id="edit_program" name="Program_ID" required>
              {% for m in prog %}
                <option value="{{ m[0] }}">{{ m[0] }}</option>
              {% endfor %}
            </select>
          </div>
          
          <div class="mb-3">
            <label class="form-label">Gender</label>
            <select class="form-select" id="edit_gender" name="Gender" required>
              <option value="Female">Female</option>
              <option value="Male">Male</option>
            </select>
          </div>
          
          <div class="mb-3">
            <label class="form-label">Year Level</label>
            <select class="form-select" id="edit_year" name="Year_Level" required>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5+">5+</option>
            </select>
          </div>
          
        </form>
      </div>
      
       <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>

        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#confirmEditModal">
          Edit
        </button>
      </div>
      
    </div>
  </div>
</div>
<div class="modal fade" id="confirmEditModal" tabindex="-1" aria-labelledby="confirmEditLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      
      <div class="modal-header">
        <h5 class="modal-title" id="confirmEditLabel">Confirm Submission</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      
      <div class="modal-body">
        Are you sure you want to Edit this student?
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
      
        <button type="submit" class="btn btn-primary" form="editStudentForm" >Yes, Edit</button>
      </div>
      
    </div>
  </div>
</div>

 <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      
      <div class="modal-header">
        <h5 class="modal-title" id="confirmDeleteLabel">Confirm Deletetion</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
             <form action="/s_delete" method="post" id="deleteStudentForm">
              <input type="hidden" name="s_id" id="deleteStudentId">
                    
      <div class="modal-body">
        Are you sure you want to delete this student?
      </div>
      
   <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
      
        <button type="submit" class="btn btn-danger" form="deleteStudentForm" >Yes, Delete</button>
      </div>
    </form>
      
    </div>
  </div>
</div>          
                        
                  
<script>
const DEFAULT_IMG_URL = "{{ url_for('static', filename='imgs/rt.jpg') }}"

let table;
$(document).ready(function() {
     table = $('#studentsTable').DataTable({
        dom: "<'row'<'col-sm-6'f><'col-sm-6'l>>" + 
     "<'row'<'col-sm-12'tr>>" +        
     "<'row mt-2'<'col-sm-6'i><'col-sm-6'p>>",
         
        "processing": true,
        "serverSide": true,
        "ajax": {
          url : "/students_data",
          data :  function (d) {
            d.program = $('#programFilter').val();
            d.gender = $('#genderFilter').val();
            d.yearlvl = $('#yearFilter').val();
        }
        },
        "columns": [
            { "data": 5, 
            "orderable": false,
            "searchable": false,
              "render": function(data, type, row) {
                  if (data && data !== 'No Image') {
                      return '<img src="' + data + '" width="100" height="90" style="border-radius:50%;" />';
                  } else {
                      return '<img src="' + DEFAULT_IMG_URL + '" width="100" height="90" style="border-radius:50%;"/>';
                  }
              } },  
            { "data": 0 },  
              { 
            "data": null,
            "render": function(data, type, row) {
              return row[1]; 
            }
            },  
            {"data" : 2},
            { "data": 7, 
            "orderable": false,
            "searchable": false  },  
            { "data" : 3 },  
            { "data": 4},
            { "data": 6 },  
            { 
              "data": null, 
              "orderable": false,
              "searchable": false,
              "render": function(data, type, row) {
                  let s_id = row[0];
                  return `
                     <div class="mt-3 mb-2">
                      <button 
      class="btn btn-primary edit-btn"
      data-pic="${row[5]}"
      data-id="${row[0]}"
      data-first-name="${row[1]}"
      data-last-name="${row[2]}"
      data-program="${row[3]}"
      data-gender="${row[7]}"
      data-yearlvl="${row[6]}"
      data-bs-toggle="modal"
      data-bs-target="#editStudentModal"
      >
      Edit
    </button>
</div>

 <input type="button" class="delete-btn btn btn-danger" 
       data-id="${row[0]}" 
       data-bs-toggle="modal" 
       data-bs-target="#confirmDeleteModal" 
       value="Delete">
                  `;
              }
            }
        ]
    });
$('#programFilter').on('change', function () {
    table.ajax.reload();
});
$('#genderFilter').on('change', function () {
    table.ajax.reload();
});
$('#yearFilter').on('change', function () {
    table.ajax.reload();
});
});


$(document).on('click', '.open', function() {
    let id = $(this).data('form-id');
    $('#form-' + id).show();
});


$(document).on('click', '.close', function() {
    let id = $(this).data('form-id');
    $('#form-' + id).hide();
});


    
</script>